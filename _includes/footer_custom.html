<!-- Back to Top Button -->
<button class="back-to-top" aria-label="–ù–∞–≤–µ—Ä—Ö" title="–ù–∞–≤–µ—Ä—Ö">‚Üë</button>

<script>
document.addEventListener('DOMContentLoaded', function() {
  
  /* GitHub Alerts */
  var alertTypes = {
    'NOTE': { icon: '&#8505;&#65039;', cls: 'alert-note', color: '#0969da', label: '–ù–∞ –∑–∞–º–µ—Ç–∫—É' },
    'TIP': { icon: '&#128161;', cls: 'alert-tip', color: '#1a7f37', label: '–ü–æ–¥—Å–∫–∞–∑–∫–∞' },
    'IMPORTANT': { icon: '&#10071;', cls: 'alert-important', color: '#8250df', label: '–í–∞–∂–Ω–æ' },
    'WARNING': { icon: '&#9888;&#65039;', cls: 'alert-warning', color: '#9a6700', label: '–í–Ω–∏–º–∞–Ω–∏–µ' },
    'CAUTION': { icon: '&#128721;', cls: 'alert-caution', color: '#cf222e', label: '–û—Å—Ç–æ—Ä–æ–∂–Ω–æ' }
  };

  var blockquotes = document.querySelectorAll('blockquote');
  for (var i = 0; i < blockquotes.length; i++) {
    var bq = blockquotes[i];
    var firstP = bq.querySelector('p');
    if (!firstP) continue;
    
    var text = firstP.innerHTML;
    var match = text.match(/^\s*(\\?\[|&#91;)!((?:NOTE|TIP|IMPORTANT|WARNING|CAUTION))(\\?\]|&#93;)\s*/i);
    
    if (match) {
      var type = match[2].toUpperCase();
      var config = alertTypes[type];
      
      if (config) {
        firstP.innerHTML = text.replace(match[0], '');
        bq.className += ' gfm-alert ' + config.cls;
        bq.style.borderLeftColor = config.color;
        bq.style.backgroundColor = config.color + '10';
        
        var title = document.createElement('div');
        title.className = 'alert-title';
        title.innerHTML = '<span style="margin-right: 6px; font-size: 1.1em;">' + config.icon + '</span>' + 
                          '<span style="font-weight: 700; font-size: 0.9em; color: ' + config.color + ';">' + config.label + '</span>';
        title.style.display = 'flex';
        title.style.alignItems = 'center';
        title.style.marginBottom = '6px';
        title.style.lineHeight = '1.2';
        
        bq.insertBefore(title, firstP);
      }
    }
  }
  
  /* Reading Time (–í—Ä–µ–º—è —á—Ç–µ–Ω–∏—è) */
  var mainContent = document.querySelector('.main-content');
  var firstH1 = mainContent ? mainContent.querySelector('h1') : null;
  
  if (mainContent && firstH1) {
    var textContent = mainContent.textContent || mainContent.innerText;
    var wordCount = textContent.trim().split(/\s+/).length;
    var readingTime = Math.ceil(wordCount / 200); /* ~200 —Å–ª–æ–≤/–º–∏–Ω –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ */
    
    function pluralMinutes(n) {
      var abs = Math.abs(n) % 100;
      var n1 = abs % 10;
      if (abs > 10 && abs < 20) return '–º–∏–Ω—É—Ç';
      if (n1 > 1 && n1 < 5) return '–º–∏–Ω—É—Ç—ã';
      if (n1 === 1) return '–º–∏–Ω—É—Ç–∞';
      return '–º–∏–Ω—É—Ç';
    }
    
    var readingTimeEl = document.createElement('div');
    readingTimeEl.className = 'reading-time';
    readingTimeEl.innerHTML = '<span class="reading-time-icon">‚è±</span> ~' + readingTime + ' ' + pluralMinutes(readingTime) + ' —á—Ç–µ–Ω–∏—è';
    
    firstH1.parentNode.insertBefore(readingTimeEl, firstH1.nextSibling);
  }
  
  /* Table of Contents (–û–≥–ª–∞–≤–ª–µ–Ω–∏–µ) */
  if (mainContent) {
    var headings = mainContent.querySelectorAll('h2[id], h3[id], h4[id]');
    
    if (headings.length >= 3) {
      var tocContainer = document.createElement('div');
      tocContainer.className = 'page-toc';
      
      var tocTitle = document.createElement('div');
      tocTitle.className = 'toc-title';
      tocTitle.innerHTML = '<span>üìë</span> –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ';
      
      var tocList = document.createElement('ul');
      tocList.className = 'toc-list';
      
      for (var j = 0; j < headings.length; j++) {
        var heading = headings[j];
        var li = document.createElement('li');
        var level = heading.tagName.toLowerCase();
        li.className = 'toc-' + level;
        
        var link = document.createElement('a');
        link.href = '#' + heading.id;
        link.textContent = heading.textContent.replace(/^#\s*/, '');
        
        li.appendChild(link);
        tocList.appendChild(li);
      }
      
      tocContainer.appendChild(tocTitle);
      tocContainer.appendChild(tocList);
      
      var readingTimeBlock = mainContent.querySelector('.reading-time');
      var insertAfter = readingTimeBlock || firstH1;
      if (insertAfter) {
        insertAfter.parentNode.insertBefore(tocContainer, insertAfter.nextSibling);
      }
      
      tocTitle.addEventListener('click', function() {
        tocContainer.classList.toggle('collapsed');
      });
    }
  }
  
  /* Back to Top Button */
  var backToTopBtn = document.querySelector('.back-to-top');
  
  if (backToTopBtn) {
    var scrollThreshold = 400;
    
    function toggleBackToTop() {
      if (window.scrollY > scrollThreshold) {
        backToTopBtn.classList.add('visible');
      } else {
        backToTopBtn.classList.remove('visible');
      }
    }
    
    window.addEventListener('scroll', toggleBackToTop, { passive: true });
    
    backToTopBtn.addEventListener('click', function() {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
    
    toggleBackToTop();
  }
  
});
</script>
