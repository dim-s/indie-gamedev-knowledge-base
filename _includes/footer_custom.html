<script>
console.log('GitHub Alerts Script Loaded v4');

document.addEventListener('DOMContentLoaded', function() {
  console.log('DOM Content Loaded - Starting Alerts processing');
  
  var alertTypes = {
    'NOTE': { icon: '&#8505;&#65039;', cls: 'alert-note', color: '#0969da', label: 'На заметку' },
    'TIP': { icon: '&#128161;', cls: 'alert-tip', color: '#1a7f37', label: 'Подсказка' },
    'IMPORTANT': { icon: '&#10071;', cls: 'alert-important', color: '#8250df', label: 'Важно' },
    'WARNING': { icon: '&#9888;&#65039;', cls: 'alert-warning', color: '#9a6700', label: 'Внимание' },
    'CAUTION': { icon: '&#128721;', cls: 'alert-caution', color: '#cf222e', label: 'Осторожно' }
  };

  var blockquotes = document.querySelectorAll('blockquote');
  console.log('Found ' + blockquotes.length + ' blockquotes');

  for (var i = 0; i < blockquotes.length; i++) {
    var bq = blockquotes[i];
    var firstP = bq.querySelector('p');
    if (!firstP) continue;
    
    var text = firstP.innerHTML;
    /* Regex matches [!TYPE] or \[!TYPE\] */
    var match = text.match(/^\s*(\\?\[|&#91;)!((?:NOTE|TIP|IMPORTANT|WARNING|CAUTION))(\\?\]|&#93;)\s*/i);
    
    if (match) {
      var type = match[2].toUpperCase();
      console.log('Match found! Type: ' + type);
      var config = alertTypes[type];
      
      if (config) {
        firstP.innerHTML = text.replace(match[0], '');
        
        bq.className += ' gfm-alert ' + config.cls;
        bq.style.borderLeftColor = config.color;
        bq.style.backgroundColor = config.color + '10';
        
        var title = document.createElement('div');
        title.className = 'alert-title';
        title.innerHTML = '<span style="margin-right: 6px; font-size: 1.1em;">' + config.icon + '</span>' + 
                          '<span style="font-weight: 700; font-size: 0.9em; color: ' + config.color + ';">' + config.label + '</span>';
        title.style.display = 'flex';
        title.style.alignItems = 'center';
        title.style.marginBottom = '6px';
        title.style.lineHeight = '1.2';
        
        bq.insertBefore(title, firstP);
      }
    }
  }
});
</script>